<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Arwen é–‹åœ˜è³¼ç‰©</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC&display=swap" rel="stylesheet">
  <script>
    const deadline = new Date("2025-06-22T23:59:59+08:00");
    if (new Date() > deadline) window.location.href = "../other/timesup.html";
  </script>
  <style>
    @media (max-width: 480px){
      .info-box{font-size:13px;padding:12px}
      .info-box p,.payment-notice p{line-height:1.8;margin:6px 0}
      .notice-title{font-size:20px}
    }
    body{font-family:"Noto Sans TC",sans-serif;background:#f3f3f3;margin:0;padding:0}
    .product-wrapper{display:flex;justify-content:center;flex-wrap:wrap;gap:40px}
    .product-card{margin-top:30px;background:#fff;padding:20px;border-radius:10px;border:1.5px solid #ccc;text-align:center;width:250px}
    .product-card img{width:200px;height:200px;object-fit:cover;border-radius:8px}
    .product-title{font-size:20px;font-weight:bold;margin:20px 0}
    .member-row{display:flex;justify-content:center;align-items:center;margin-top:10px;gap:10px}
    .member-name{width:30px}
    .qty-btn{width:30px;height:30px;background:#d7a9f9;border:none;border-radius:5px;color:#fff;font-size:18px;cursor:pointer}
    .qty-input{width:40px;height:30px;text-align:right;font-size:16px;border:1px solid #ccc;border-radius:5px}
    .total{font-size:25px;font-weight:bold;text-align:center;margin:30px 0}
    .submit-btn{background:linear-gradient(45deg,#6e46ae,#d7a9f9);color:#fff;font-size:16px;padding:10px 30px;border:none;border-radius:8px;cursor:pointer;margin-top:20px}
    #order-summary-text{font-weight:300;font-size:16px;line-height:1.6;text-align:center}
    #checkout-section{margin-top:30px;padding-top:20px;border-top:2px dashed #ccc}
    .payment-notice{background:#a798bd;color:#fff;padding:5px;border-radius:10px;text-align:center;line-height:0.8;margin-bottom:30px;font-size:15px}
    .form-group{margin-top:15px}
    .form-group input,.form-group select{width:100%;padding:10px;border:1px solid #ccc;border-radius:5px;margin-top:5px}
    .invalid{border:2px solid #e74c3c;background:#fff0f0}
    .error-message{font-size:13px;color:#e74c3c;margin-top:5px;display:none}
    .stock-remaining{margin-top:10px;font-size:14px;color:#666}
  </style>
</head>
<body>
<div class="product-wrapper">
  <div class="product-card" data-price="2080" data-stock="10">
    <img src="../image/presale/wvs - w.jpg" alt="wvsé å”®æŒ‡å®šå†¬">
    <div class="product-title">wvsé å”®æŒ‡å®šå†¬ - $600</div>
    <div class="member-row" data-member="å†¬">
      <span class="member-name">å†¬</span>
      <button class="qty-btn" onclick="updateQty(this,-1)">-</button>
      <input type="number" class="qty-input" value="0" readonly>
      <button class="qty-btn" onclick="updateQty(this,1)">+</button>
    </div>
    <div class="stock-remaining">å‰©é¤˜ 10 ä»¶</div>
  </div>
</div>

<div class="total">ç¸½é‡‘é¡ï¼š<span id="total-price">$0</span></div>
<div style="text-align:center;"><button class="submit-btn" onclick="showCheckout()">çµå¸³</button></div>

<div id="checkout-section" style="display:none;">
  <div class="total" id="order-summary-text"></div>
  <div class="payment-notice">
    <p>ğŸ’°ä»˜æ¬¾é ˆçŸ¥ï¼šåŒ¯æ¬¾/ç„¡å¡å¸³è™Ÿ:</p>
    <p>è«‹å‹¿å‚™è¨»ä»»ä½•å­—ç¬¦! æœƒå°ä¸åˆ°å¸³</p>
    <p>ï¼ˆ822ï¼‰901566584648</p>
    <p>è«‹å…ˆå®Œæˆä»˜æ¬¾å¾Œå†é€å‡ºè¡¨å–®</p>
    <p>è‹¥æœªæ”¶åˆ°æ¬¾é …ï¼Œå°‡ä¸åˆ—å…¥æ­¤æ¬¡è¨‚å–®ã€‚</p>
    <p>ç„¡å¡ï¼šå¡«å¯«ç¢ºåˆ‡æ—¥æœŸæ™‚é–“ä¸¦ç„¡å¡è‡³ç™¾ä½æ•¸ï¼Œå‰©é¤˜äºŒè£œ</p>
  </div>
  <div class="form-group">
    <label for="email">*Gmailä¿¡ç®±ï¼ˆå¯å¡«ä»»ä½• emailï¼‰</label>
    <input type="text" id="email" placeholder="xxxxx" required oninput="validateEmail(this)">
    <div id="email-error" class="error-message">è«‹è¼¸å…¥æ­£ç¢ºçš„ Email æ ¼å¼</div>
  </div>
  <div class="form-group"><label for="name">*ç¤¾ç¾¤å…§æ‚¨çš„å§“å</label><input type="text" id="name" required></div>
  <div class="form-group">
    <label for="amount">*åŒ¯æ¬¾/ç„¡å¡é‡‘é¡</label>
    <input type="text" id="amount" required oninput="validateAmount(this)">
    <div id="amount-error" class="error-message">åªèƒ½å¡«å¯«æ•¸å­—ï¼Œæœ€å¤šå…©ä½å°æ•¸</div>
  </div>
  <div class="form-group"><label for="bank">åŒ¯æ¬¾éŠ€è¡Œ+æœ«äº”ç¢¼</label><input type="text" id="bank" required></div>
  <div class="form-group"><label for="time">ç„¡å¡æ™‚é–“</label><input type="text" id="time"></div>
  <div class="form-group">
    <label for="agree">*æ˜¯å¦åŒæ„è³¼è²·é ˆçŸ¥</label>
    <select id="agree" required><option value="">è«‹é¸æ“‡</option><option value="æ˜¯">æ˜¯</option></select>
  </div>
  <div style="text-align:center;"><button class="submit-btn" onclick="submitOrder()">é€å‡ºè¨‚å–®</button></div>
</div>

<script>
const nameWhitelist = ["å¡æ‹‰é›è…¿å ¡", "snow", "Sean", "é‡‘å†¬ç”œ", "ğŸ©µğŸ‘¶ğŸ»ğŸ©µ","Djjj"];

function updateQty(btn, delta) {
  const card = btn.closest(".product-card");
  const stock = parseInt(card.dataset.stock);
  const inp = btn.parentElement.querySelector("input");
  let q = parseInt(inp.value) + delta;

  let totalQty = 0;
  card.querySelectorAll(".qty-input").forEach(i => totalQty += parseInt(i.value));
  if (delta > 0 && totalQty >= stock) {
    alert(`æ­¤å•†å“é™é‡ ${stock} ä»¶ï¼Œå·²ç„¡æ³•å†åŠ è³¼ï¼`);
    return;
  }
  if (q < 0) q = 0;
  inp.value = q;
  updateTotal();
  const remaining = stock - [...card.querySelectorAll(".qty-input")].reduce((a, i) => a + parseInt(i.value), 0);
  card.querySelector(".stock-remaining").innerText = `å‰©é¤˜ ${remaining} ä»¶`;
}

function updateTotal() {
  let t = 0;
  document.querySelectorAll(".product-card").forEach(card => {
    const price = parseInt(card.dataset.price);
    card.querySelectorAll(".qty-input").forEach(i => {
      t += price * parseInt(i.value);
    });
  });
  document.getElementById("total-price").innerText = `$${t}`;
}

function showCheckout() {
  const summary = [];
  document.querySelectorAll(".product-card").forEach(card => {
    const title = card.querySelector(".product-title").innerText;
    const lines = [];
    card.querySelectorAll(".member-row").forEach(r => {
      const m = r.dataset.member;
      const q = parseInt(r.querySelector("input").value);
      if (q > 0) lines.push(`${m} x${q}`);
    });
    if (lines.length) summary.push(`${title}<br>${lines.join("<br>")}`);
  });
  if (!summary.length) {
    alert("è«‹è‡³å°‘é¸æ“‡ä¸€é …å•†å“å†çµå¸³ï¼");
    return;
  }
  document.getElementById("order-summary-text").innerHTML = `<strong>æ‚¨çš„è³¼è²·æ˜ç´°ï¼š</strong><br><br>${summary.join("<br><br>")}`;
  document.getElementById("checkout-section").style.display = "block";
  window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
}

function validateEmail(input) {
  const val = input.value.trim();
  const err = document.getElementById("email-error");
  const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailPattern.test(val)) {
    input.classList.add("invalid");
    err.style.display = "block";
  } else {
    input.classList.remove("invalid");
    err.style.display = "none";
  }
}

function validateAmount(input) {
  const v = input.value.trim();
  const err = document.getElementById("amount-error");
  if (v === "" || /^\d+(\.\d{0,2})?$/.test(v)) {
    input.classList.remove("invalid");
    err.style.display = "none";
  } else {
    input.classList.add("invalid");
    err.style.display = "block";
  }
}

function submitOrder() {
  const emailInput = document.getElementById("email").value.trim();
  const name = document.getElementById("name").value.trim();
  const passName = nameWhitelist.includes(name);
  if (!passName) {
    alert("æ­¤å¸³è™Ÿ/å§“åä¸åœ¨ç™½åå–®å…§ï¼Œç„¡æ³•ä¸‹å–®ï¼");
    return;
  }

  const amount = document.getElementById("amount").value.trim();
  const bank = document.getElementById("bank").value.trim();
  const time = document.getElementById("time").value.trim();
  const agree = document.getElementById("agree").value;
  if (!emailInput || !name || !amount || !agree) {
    alert("è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½ï¼");
    return;
  }
  if (!/^\d+(\.\d{0,2})?$/.test(amount)) {
    alert("åŒ¯æ¬¾é‡‘é¡æ ¼å¼éŒ¯èª¤ï¼Œåªèƒ½å¡«å¯«æ•¸å­—ï¼");
    return;
  }

  const qtys = {};
  document.querySelectorAll(".member-row").forEach(r => {
    const m = r.dataset.member;
    const q = parseInt(r.querySelector("input").value);
    qtys[m] = (qtys[m] || 0) + q;
  });
  const total = document.getElementById("total-price").innerText.replace("$", "");

  const postData = {
    "entry.277065803": total,
    "entry.1834756956": emailInput,
    "entry.731592523": name,
    "entry.257137855": amount,
    "entry.2025982434": bank,
    "entry.202573232": time,
    "entry.453294272": agree,
  };

  fetch("https://docs.google.com/forms/d/1m865ZTjsh6a1ItHgc2d0mWNP12dzBNPtoJeTtVbjkMY/formResponse", {
    method: "POST",
    mode: "no-cors",
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    body: new URLSearchParams(postData).toString()
  }).then(() => window.location.href = "../other/done.html")
    .catch(() => window.location.href = "../other/error.html");
}

window.addEventListener("DOMContentLoaded", () => {
  ["email", "name", "bank"].forEach(id => {
    document.getElementById(id).value = localStorage.getItem("saved" + id.charAt(0).toUpperCase() + id.slice(1)) || "";
  });
});
</script>
</body>
</html>